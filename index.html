<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2048 Game</title>
    <style>
        body { font-family: Arial, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        #game { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; background-color: #bbada0; padding: 10px; border-radius: 5px; }
        .cell { width: 100px; height: 100px; background-color: #cdc1b4; border-radius: 5px; display: flex; justify-content: center; align-items: center; font-size: 24px; font-weight: bold; }
    </style>
</head>
<body>
    <div id="game"></div>
    <script>
        const game = document.getElementById('game');
        let board = Array(16).fill(0);

        function initGame() {
            addNewTile();
            addNewTile();
            updateBoard();
        }

        function addNewTile() {
            let emptyTiles = board.reduce((acc, val, idx) => val === 0 ? [...acc, idx] : acc, []);
            if (emptyTiles.length > 0) {
                let randomIndex = emptyTiles[Math.floor(Math.random() * emptyTiles.length)];
                board[randomIndex] = Math.random() < 0.9 ? 2 : 4;
            }
        }

        function updateBoard() {
            game.innerHTML = '';
            board.forEach(value => {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.textContent = value !== 0 ? value : '';
                game.appendChild(cell);
            });
        }

        document.addEventListener('keydown', handleKeyPress);

        function handleKeyPress(e) {
            let moved = false;
            switch (e.key) {
                case 'ArrowUp': moved = moveUp(); break;
                case 'ArrowDown': moved = moveDown(); break;
                case 'ArrowLeft': moved = moveLeft(); break;
                case 'ArrowRight': moved = moveRight(); break;
            }
            if (moved) {
                addNewTile();
                updateBoard();
            }
        }

        function moveLeft() {
            let moved = false;
            for (let i = 0; i < 4; i++) {
                let row = board.slice(i * 4, i * 4 + 4);
                let filteredRow = row.filter(tile => tile !== 0);
                for (let j = 0; j < filteredRow.length - 1; j++) {
                    if (filteredRow[j] === filteredRow[j + 1]) {
                        filteredRow[j] *= 2;
                        filteredRow[j + 1] = 0;
                        moved = true;
                    }
                }
                filteredRow = filteredRow.filter(tile => tile !== 0);
                while (filteredRow.length < 4) filteredRow.push(0);
                if (JSON.stringify(row) !== JSON.stringify(filteredRow)) moved = true;
                board.splice(i * 4, 4, ...filteredRow);
            }
            return moved;
        }

        function moveRight() {
            board.reverse();
            let moved = moveLeft();
            board.reverse();
            return moved;
        }

        function moveUp() {
            board = transpose(board);
            let moved = moveLeft();
            board = transpose(board);
            return moved;
        }

        function moveDown() {
            board = transpose(board);
            let moved = moveRight();
            board = transpose(board);
            return moved;
        }

        function transpose(arr) {
            return arr.map((_, i) => arr.filter((_, j) => i % 4 === j % 4));
        }

        initGame();
    </script>
</body>
</html>